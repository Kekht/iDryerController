# Прошивка

Универсальное решение для сушки филамента. Можно собрать из чего-то доступного и дешевого, например старого нагревателя от хитблока, ненужного кулера и радиатора, а в качестве корпуса использовать коробку из хоз.мага и любой утеплитель. Список используемых деталей ограничен только фантазией.

Что умеет:
- сушить на температуре до 100С 
- сушить на выбранной температуре заданное время;
- регулировать мощность нагревателя и достаточно точно поддерживать необходимую температуру воздуха в сушилке;
- проветривать камеру через заданные промежутки времени
- отображать температуру воздуха, нагревательного элемента, влажность; 
- по окончании сушки переходить в режим хранения и хранить с небольшим нагревом бесконечно долго;
- хранить с выбранной температурой;
- при достижении заданной влажности экономить электроэнергию, включать/выключать сушку по параметру HUMIDITY_HYSTERESIS;
- имеет пресеты под часто используемые пластики;
- автоматически настраивать пид;
- взвешивать катушку и писать остаток пластика на экране;
- генерировать высокий сигнал на пине для соединения с входом датчика филамента платы принтера.

Особенности железа:
- управление почти любым нагревательным элементом 24/220В;
- управление вентилятором обдува камеры по ШИМ;
- версия для работы с напряжением 24В(можно и 12В);
- версия для работы с напряжением 220В;
- использование дешевых китайских модулей весов для получения вполне достоверных результатов веса катушки
Дизайн платы размещены на [jlcpcb.com](https://oshwlab.com/svet_team/idryer)


Особенности прошивок:
- файл прошивки содержит все возможные варианты, настройка прошивки редактируется в файле configuration.h
- прошивка для бутлоадера ардуино / штука не самая безопасная несмотря на кучу проверок и защит
  - начиная с v0.5.* поддержка завершена, функционал не тестировался, все отсылы в прошивке являются атавизмами
- прошивка под ядро MiniCore
  - работает watch dog timer / в случае программного cбоя перезагрузит прошивку
  - русский и английский языки
  - PID регулирование
  - режимы сушки и хранения
  - поддержка выбора частот шим вентилятора
  - тест оптимальных частот вентилятор
  - поддержка до 4х модулей весов на АЦП HX711
  - опрос весов 10 и 80 раз в секунду
  - вывод веса катушек на экран
  - ввод веса тары в меню
  - сигнализация об окончании филамента визульная, звуковая, в выход датчика филамента
  - [поддержка сервопривода](https://t.me/iDryer/361)для регулярного проветривания камеры
  - пользовательские названия пресетов
  - расширенное меню и функции
  - безопасность прошивки
  
!!! warning annotate "ВАЖНО!"

    :arrow_forward:</i> При эксплуатации необходимо помнить о правилах обращения с бытовой электротехникой и электро нагревательными приборами. 

    :arrow_forward:</i> Используемы алгоритмы не могут гарантировать 100% безопасность устройства.
    


Коммутация:

Соедините Arduino Nano с программатором USBASP
(ArduinoISP не тестировалось с существующими секциями platfornio.ini, необходимо писать самостоятельно) 
<!-- https://raw.githubusercontent.com/pavluchenkor/iDryerController/master/src_isp/pins.png -->
![img](https://raw.githubusercontent.com/pavluchenkor/iDryerController/master/src_isp/pins.png)

![img](https://raw.githubusercontent.com/pavluchenkor/iDryerController/master/src_isp/usbasp10.jpg)

Обратите внимание, что цоколевка разъемов может отличаться

![img](https://raw.githubusercontent.com/pavluchenkor/iDryerController/master/src_isp/img001.png)

Компиляция и прошивка:

!!! warning annotate "Внимание"

    :arrow_forward:</i> В файле configuration.h сконфигурируйте прошивку.
    
    :arrow_forward:</i> в файле platformio.ini указать USB порт к которому подключена ардуина


1. Прошивка ядра MiniCore
Потребуется программатор USBASP

2.1 смена фьюзов
    pio run -e fuses -t fuses

2.2 прошивка EEPROM<br>
    pio run -e EEP -t uploadeep
    если используется Atmega328PB
    pio run -e EEPB -t uploadeep

###Прошивка общая
2.3 прошивка МК<br>
    pio run -e EEP -t upload
    если используется Atmega328PB
    pio run -e EEPB -t upload 

###Прошивка для работы с модулями весов
Выполняется в два этапа:
В configuration.h устанавливается
#define AUTOPID_RUN 1
#define SCALES_MODULE_NUM Х (Х = количество весов)
Выполняется прошивка п.2.3
После прошивки начнется автоматическая настройдка PID, по окончании на экране появится надпись "Прошей часть 2"
сменить на #define AUTOPID_RUN 0
и выполнить п.2.3

###Прошивка теста кулера
В configuration.h раскомментировать // #define PWM_TEST
выполнить п.2.3
Начнется тест кулера на всех доступных частотах с заполнением ШИМ 100-10% и выводом режима работы на экран. По окнчании теста, ориентируясь на свои предпочтения по уровню шума и качеству работы кулера установить в configuration.h #define PWM_11_FREQUENCY желаемую частоту,  закмментировать #define PWM_TEST, прошить МК п.2.3


> Если после прошивки и в процессе эксплуатации на экране появятся ошибки, обратитесь к файлу configuration.h

## Учебное видео
<div class="video-wrapper">
  <iframe width="1280" height="720" src="https://www.youtube.com/embed/psw30jXlxPQ" frameborder="0" allowfullscreen></iframe>
</div>
Ссылки к видео:

[VS Code](https://code.visualstudio.com/Download)

[Драйвер](https://zadig.akeo.ie/)

[Прошивка](https://github.com/pavluchenkor/iDryerController)


[группа в телеграмм :fontawesome-solid-paper-plane:](https://t.me/iDryer){ .md-button }

[Contributing :material-file-edit:](https://github.com/pavluchenkor/iDryerController)
